name: doc-track-add
display_name: "â• Add Document to Tracking"
description: |
  ã‚¹ã‚­ãƒ«: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½è·¡ã«è¿½åŠ ã™ã‚‹

  å®Ÿè£…ã«é–¢é€£ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½è·¡ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¾ã™ã€‚
  å®Ÿè£…å®Œäº†å¾Œã€ã“ã‚Œã‚‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã‚’è¨˜éŒ²ã—ã¾ã™ã€‚

  ä½¿ç”¨ä¾‹:
    /doc-track-add --path "README.md" --reason "æ–°æ©Ÿèƒ½ã®ä½¿ç”¨æ–¹æ³•ã‚’è¿½åŠ "
    /doc-track-add --path "docs/API.md" --reason "æ–°APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ " --section "èªè¨¼API"
    /doc-track-add --path "README.md" --reason "ä½¿ç”¨æ–¹æ³•ã‚’æ›´æ–°" --line-start 50 --line-end 75

category: documentation
version: "1.0.0"

parameters:
  - name: path
    description: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ‘ã‚¹ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰ã®ç›¸å¯¾ãƒ‘ã‚¹ï¼‰
    required: true
    type: string

  - name: reason
    description: ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹ç†ç”±
    required: true
    type: string

  - name: section
    description: æ›´æ–°ãŒå¿…è¦ãªã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    required: false
    type: string

  - name: line-start
    description: æ›´æ–°ãŒå¿…è¦ãªé–‹å§‹è¡Œç•ªå·ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    required: false
    type: string

  - name: line-end
    description: æ›´æ–°ãŒå¿…è¦ãªçµ‚äº†è¡Œç•ªå·ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    required: false
    type: string

script: |
  #!/usr/bin/env python3
  import sys
  import os
  from pathlib import Path

  # MAOãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
  sys.path.insert(0, str(Path(__file__).parent.parent.parent))
  from mao.orchestrator.document_tracker import DocumentTracker

  # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‘ã‚¹
  project_path = Path(os.environ.get("PWD", "."))

  # ã‚»ãƒƒã‚·ãƒ§ãƒ³IDå–å¾—
  current_session = os.environ.get("MAO_SESSION_ID")
  if not current_session:
      print("âŒ ã‚¨ãƒ©ãƒ¼: MAOã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
      print("   ã¾ãš /doc-track-start ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¦ãã ã•ã„")
      sys.exit(1)

  # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾—
  doc_path = os.environ.get("PATH", "")
  reason = os.environ.get("REASON", "")
  section = os.environ.get("SECTION", "")
  line_start_str = os.environ.get("LINE_START", "")
  line_end_str = os.environ.get("LINE_END", "")

  if not doc_path or not reason:
      print("âŒ ã‚¨ãƒ©ãƒ¼: path ã¨ reason ãŒå¿…è¦ã§ã™")
      sys.exit(1)

  # è¡Œç•ªå·ã‚’æ•´æ•°ã«å¤‰æ›
  line_start = None
  line_end = None
  try:
      if line_start_str:
          line_start = int(line_start_str)
      if line_end_str:
          line_end = int(line_end_str)
  except ValueError:
      print("âŒ ã‚¨ãƒ©ãƒ¼: è¡Œç•ªå·ã¯æ•´æ•°ã§æŒ‡å®šã—ã¦ãã ã•ã„")
      sys.exit(1)

  # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒˆãƒ©ãƒƒã‚«ãƒ¼åˆæœŸåŒ–
  tracker = DocumentTracker(project_path=project_path)

  # ã‚»ãƒƒã‚·ãƒ§ãƒ³å­˜åœ¨ç¢ºèª
  session_info = tracker.get_session_info(current_session)
  if not session_info:
      print("âŒ ã‚¨ãƒ©ãƒ¼: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªè¿½è·¡ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
      print("   /doc-track-start ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¦ãã ã•ã„")
      tracker.close()
      sys.exit(1)

  # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ 
  success = tracker.add_document(
      session_id=current_session,
      document_path=doc_path,
      reason=reason,
      section=section or None,
      line_start=line_start,
      line_end=line_end
  )

  if success:
      print(f"âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½è·¡ã«è¿½åŠ ã—ã¾ã—ãŸ")
      print(f"ğŸ“„ ãƒ‘ã‚¹: {doc_path}")
      print(f"ğŸ“ ç†ç”±: {reason}")
      if section:
          print(f"ğŸ“Œ ã‚»ã‚¯ã‚·ãƒ§ãƒ³: {section}")
      if line_start is not None or line_end is not None:
          if line_start is not None and line_end is not None:
              print(f"ğŸ“ è¡Œç¯„å›²: {line_start}-{line_end}")
          elif line_start is not None:
              print(f"ğŸ“ é–‹å§‹è¡Œ: {line_start}")
          elif line_end is not None:
              print(f"ğŸ“ çµ‚äº†è¡Œ: {line_end}")
      print()

      # ç¾åœ¨ã®è¿½è·¡ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•°ã‚’è¡¨ç¤º
      docs = tracker.get_tracked_documents(current_session)
      print(f"ğŸ“Š è¿½è·¡ä¸­ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: {len(docs)}ä»¶")
  else:
      print("âŒ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")
      sys.exit(1)

  tracker.close()

requires_approval: false
risk_level: low

metadata:
  author: MAO System
  tags:
    - documentation
    - tracking
  examples:
    - description: READMEã‚’è¿½è·¡ã«è¿½åŠ 
      command: /doc-track-add --path "README.md" --reason "æ–°æ©Ÿèƒ½ã®èª¬æ˜ã‚’è¿½åŠ "

    - description: APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½è·¡ã«è¿½åŠ 
      command: /doc-track-add --path "docs/API.md" --reason "æ–°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¿½åŠ " --section "èªè¨¼API"

    - description: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¿½è·¡
      command: /doc-track-add --path "docs/CONFIGURATION.md" --reason "æ–°ã—ã„è¨­å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³è¿½åŠ "

    - description: è¡Œç•ªå·ã‚’æŒ‡å®šã—ã¦è¿½è·¡
      command: /doc-track-add --path "README.md" --reason "ä½¿ç”¨æ–¹æ³•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°" --line-start 50 --line-end 75

    - description: é–‹å§‹è¡Œã®ã¿æŒ‡å®š
      command: /doc-track-add --path "docs/API.md" --reason "æ–°APIã‚’è¿½åŠ " --section "REST API" --line-start 100
