name: pr
display_name: "ðŸ”€ Create Pull Request"
description: |
  Create a GitHub Pull Request from the current branch.

  This skill automates PR creation workflow:
  1. Ensure changes are committed
  2. Push current branch to remote
  3. Create PR with title and description
  4. Optionally set reviewers, labels, and milestone

  Usage:
    /pr                                    # Create PR with auto-generated content
    /pr --title "Feature: Add auth"        # Custom PR title
    /pr --draft                            # Create as draft PR
    /pr --base main                        # Target branch (default: main)

version: "1.0.0"

parameters:
  - name: title
    short: t
    description: "PR title (auto-generated from commits if not specified)"
    type: string
    required: false

  - name: body
    short: b
    description: "PR description (auto-generated if not specified)"
    type: string
    required: false

  - name: base
    description: "Base branch to merge into (default: main)"
    type: string
    required: false
    default: "main"

  - name: draft
    short: d
    description: "Create as draft PR"
    type: boolean
    default: false

  - name: auto-merge
    description: "Enable auto-merge (requires branch protection)"
    type: boolean
    default: false

  - name: labels
    short: l
    description: "Comma-separated labels to add"
    type: string
    required: false

  - name: reviewers
    short: r
    description: "Comma-separated reviewers to request"
    type: string
    required: false

examples:
  - command: "/pr"
    description: "Create PR with auto-generated title and body"

  - command: "/pr --title 'Fix auth bug' --draft"
    description: "Create draft PR with custom title"

  - command: "/pr --labels bug,urgent --reviewers alice,bob"
    description: "Create PR with labels and reviewers"

  - command: "/pr --base develop"
    description: "Create PR targeting develop branch"

script: |
  #!/bin/bash
  set -e

  # Parse arguments
  TITLE=""
  BODY=""
  BASE="main"
  DRAFT=""
  AUTO_MERGE=""
  LABELS=""
  REVIEWERS=""

  while [[ $# -gt 0 ]]; do
    case $1 in
      --title|-t)
        TITLE="$2"
        shift 2
        ;;
      --body|-b)
        BODY="$2"
        shift 2
        ;;
      --base)
        BASE="$2"
        shift 2
        ;;
      --draft|-d)
        DRAFT="--draft"
        shift
        ;;
      --auto-merge)
        AUTO_MERGE="--auto-merge"
        shift
        ;;
      --labels|-l)
        LABELS="$2"
        shift 2
        ;;
      --reviewers|-r)
        REVIEWERS="$2"
        shift 2
        ;;
      *)
        shift
        ;;
    esac
  done

  # Get current branch
  CURRENT_BRANCH=$(git branch --show-current)

  if [ -z "$CURRENT_BRANCH" ]; then
    echo "Error: Not on a branch"
    exit 1
  fi

  # Check for uncommitted changes
  if ! git diff-index --quiet HEAD --; then
    echo "Warning: You have uncommitted changes. Please commit them first."
    echo "Hint: Use /commit to commit changes"
    exit 1
  fi

  # Push current branch
  echo "Pushing branch to remote..."
  git push -u origin "$CURRENT_BRANCH"

  # Auto-generate title if not provided
  if [ -z "$TITLE" ]; then
    # Get last commit message as title
    TITLE=$(git log -1 --pretty=%s)
  fi

  # Auto-generate body if not provided
  if [ -z "$BODY" ]; then
    # Get commit messages since base branch
    BODY=$(cat <<EOF
  ## Changes
  $(git log --pretty=format:"- %s" origin/$BASE..HEAD)

  ## Commits
  $(git log --pretty=format:"- %h %s (%an)" origin/$BASE..HEAD)

  ---
  ðŸ¤– Generated by MAO
  EOF
  )
  fi

  # Build gh pr create command
  CMD="gh pr create --title \"$TITLE\" --body \"$BODY\" --base \"$BASE\""

  if [ -n "$DRAFT" ]; then
    CMD="$CMD $DRAFT"
  fi

  if [ -n "$AUTO_MERGE" ]; then
    CMD="$CMD --auto-merge"
  fi

  if [ -n "$LABELS" ]; then
    # Convert comma-separated to multiple --label flags
    IFS=',' read -ra LABEL_ARRAY <<< "$LABELS"
    for label in "${LABEL_ARRAY[@]}"; do
      CMD="$CMD --label \"${label// /}\""
    done
  fi

  if [ -n "$REVIEWERS" ]; then
    # Convert comma-separated to multiple --reviewer flags
    IFS=',' read -ra REVIEWER_ARRAY <<< "$REVIEWERS"
    for reviewer in "${REVIEWER_ARRAY[@]}"; do
      CMD="$CMD --reviewer \"${reviewer// /}\""
    done
  fi

  # Execute command
  echo "Creating pull request..."
  eval $CMD

  echo "âœ“ Pull request created successfully!"

security:
  risk_level: medium
  requires_approval: false
  dangerous_operations:
    - git_push
    - github_api

  rationale: |
    This skill pushes to remote and creates a PR via GitHub API.
    It's considered medium risk because:
    - It pushes the current branch to remote
    - It creates a PR that others can review

    However, it's safe because:
    - PRs require review before merging (in most repos)
    - All changes are visible in git
    - Can be closed/reverted easily

metadata:
  category: version_control
  tags:
    - git
    - github
    - pr
    - pull-request
  author: "Claude Opus 4.5"
  created_at: "2026-02-02"
