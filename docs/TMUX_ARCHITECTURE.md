# Tmux ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ - Claude Code ã®ãƒšã‚¤ãƒ³å†…å®Ÿè¡Œ

## ğŸ¯ æ¦‚è¦

å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒ tmux ãƒšã‚¤ãƒ³å†…ã§ç›´æ¥ claude-code ã‚’å®Ÿè¡Œã™ã‚‹æ–°ã—ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€‚
[multi-agent-shogun](https://zenn.dev/shio_shoppaize/articles/5fee11d03a11a1) ã®æ‰‹æ³•ã‚’æ¡ç”¨ã€‚

## ğŸ—ï¸ æ—§ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ vs æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### âŒ æ—§ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆå•é¡Œã‚ã‚Šï¼‰

```
ClaudeCodeExecutor (subprocess)
    â†“ ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿
ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«
    â†“ tail -f ã§ç›£è¦–
Tmux Pane (ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„)
```

**å•é¡Œç‚¹:**
- subprocess ã§ claude-code ã‚’å®Ÿè¡Œ
- tmux ã§ã¯ `tail -f log_file` ã‚’å®Ÿè¡Œ
- ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒé©åˆ‡ã«æ›¸ãè¾¼ã¾ã‚Œãšã€tmux ã«ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ tmux ã«ã‚¢ã‚¿ãƒƒãƒã—ã¦ã‚‚ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨å¯¾è©±ã§ããªã„

### âœ… æ–°ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆä¿®æ­£æ¸ˆã¿ï¼‰

```
Tmux Pane
    â†“ tmux send-keys ã§å®Ÿè¡Œ
Claude Code (ãƒšã‚¤ãƒ³å†…ã§ç›´æ¥å®Ÿè¡Œ)
    â†“ å‡ºåŠ›ãŒç›´æ¥ãƒšã‚¤ãƒ³ã«è¡¨ç¤º
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ tmux attach ã§é–²è¦§å¯èƒ½
```

**åˆ©ç‚¹:**
- claude-code ãŒãƒšã‚¤ãƒ³å†…ã§ç›´æ¥å®Ÿè¡Œã•ã‚Œã‚‹
- å‡ºåŠ›ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ tmux ã«è¡¨ç¤ºã•ã‚Œã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ `tmux attach -t mao` ã§å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½œæ¥­ã‚’ç¢ºèªå¯èƒ½
- multi-agent-shogun ã¨åŒã˜ event-driven ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

## ğŸ“‹ å®Ÿè£…ã®è©³ç´°

### 1. TmuxManager ã®æ–°ãƒ¡ã‚½ãƒƒãƒ‰

#### `execute_claude_code_in_pane()`

ãƒšã‚¤ãƒ³å†…ã§ claude-code ã‚’ --print ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œã€‚

```python
tmux_manager.execute_claude_code_in_pane(
    pane_id="mao:0.0",
    prompt="èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„",
    model="sonnet",
    work_dir=Path("/path/to/project"),
    allow_unsafe=False,
)
```

**å†…éƒ¨å‡¦ç†:**
1. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿
2. `cat prompt.txt | claude-code --print --model sonnet` ã‚’æ§‹ç¯‰
3. `tmux send-keys` ã§ãƒšã‚¤ãƒ³å†…ã«ã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡

**é‡è¦:** Zenn è¨˜äº‹ã®çŸ¥è¦‹ã‚ˆã‚Šã€`send-keys` ã¯**2å›ã«åˆ†ã‘ãªã„ã¨ Enter ãŒåŠ¹ã‹ãªã„**:

```python
# âŒ NG: Enter ãŒå®Ÿè¡Œã•ã‚Œãªã„
subprocess.run(["tmux", "send-keys", "-t", pane_id, "command", "Enter"])

# âœ… OK: 2å›ã«åˆ†ã‘ã‚‹
self._send_to_pane(pane_id, "command")  # send-keys + C-m ã§ Enter
```

#### `execute_interactive_claude_code_in_pane()`

ãƒšã‚¤ãƒ³å†…ã§ claude-code ã‚’ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ã€‚

```python
tmux_manager.execute_interactive_claude_code_in_pane(
    pane_id="mao:0.0",
    model="sonnet",
    work_dir=Path("/path/to/project"),
    allow_unsafe=False,
)
```

**ç”¨é€”:** ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç”¨ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç›´æ¥å¯¾è©±å¯èƒ½ã€‚

#### `start_worker_loop_in_pane()`

ãƒšã‚¤ãƒ³å†…ã§ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ«ãƒ¼ãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èµ·å‹•ã€‚

```python
tmux_manager.start_worker_loop_in_pane(
    pane_id="mao:0.1",
    role="worker-1",
    project_path=Path("/path/to/project"),
    model="sonnet",
    poll_interval=2.0,
    allow_unsafe=False,
)
```

**å†…éƒ¨å‡¦ç†:**
```bash
python3 mao/orchestrator/worker_loop.py \
    --role worker-1 \
    --project-path /path/to/project \
    --model sonnet \
    --poll-interval 2.0
```

### 2. TaskQueue - YAML ãƒ™ãƒ¼ã‚¹ã®ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼

ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“é€šä¿¡ã« YAML ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨ï¼ˆmulti-agent-shogun ã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ã€‚

#### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
.mao/
â””â”€â”€ queue/
    â”œâ”€â”€ tasks/           # æœªå‡¦ç†ã‚¿ã‚¹ã‚¯
    â”‚   â”œâ”€â”€ worker-1.yaml
    â”‚   â”œâ”€â”€ worker-2.yaml
    â”‚   â””â”€â”€ ...
    â””â”€â”€ results/         # å®Œäº†çµæœ
        â”œâ”€â”€ worker-1.yaml
        â”œâ”€â”€ worker-2.yaml
        â””â”€â”€ ...
```

#### ã‚¿ã‚¹ã‚¯ã®æµã‚Œ

```python
from mao.orchestrator.task_queue import TaskQueue, Task, TaskStatus

queue = TaskQueue(project_path)

# 1. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒã‚¿ã‚¹ã‚¯ã‚’å‰²ã‚Šå½“ã¦
task = Task(
    task_id="task-001",
    role="worker-1",
    prompt="ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„",
    model="sonnet",
)
queue.assign_task(task)  # â†’ .mao/queue/tasks/worker-1.yaml

# 2. ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒã‚¿ã‚¹ã‚¯ã‚’å–å¾—ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã¯å‰Šé™¤ã•ã‚Œã‚‹ï¼‰
task = queue.get_task("worker-1")  # worker-1.yaml ã‚’èª­ã¿è¾¼ã¿ï¼†å‰Šé™¤

# 3. ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œ
task.status = TaskStatus.IN_PROGRESS
# ... claude-code å®Ÿè¡Œ ...
task.status = TaskStatus.COMPLETED
task.result = "å®Ÿè£…å®Œäº†ã—ã¾ã—ãŸ"

# 4. ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒçµæœã‚’æå‡º
queue.submit_result(task)  # â†’ .mao/queue/results/worker-1.yaml

# 5. ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒçµæœã‚’å–å¾—
result = queue.get_result("worker-1")  # worker-1.yaml ã‚’èª­ã¿è¾¼ã¿ï¼†å‰Šé™¤
```

### 3. WorkerLoop - ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒªãƒ³ã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

å„ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒšã‚¤ãƒ³å†…ã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã€‚

#### å‹•ä½œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ«ãƒ¼ãƒ—é–‹å§‹          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ã‚¿ã‚¹ã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèª        â”‚
â”‚ (.mao/queue/tasks/role.yaml)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“ ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ï¼Ÿ
           â”œâ”€ Yes
           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  â”‚ ã‚¿ã‚¹ã‚¯ã‚’èª­ã¿è¾¼ã¿    â”‚
           â”‚  â”‚ (ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤)      â”‚
           â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚         â†“
           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  â”‚ claude-code å®Ÿè¡Œ    â”‚
           â”‚  â”‚ (--print ãƒ¢ãƒ¼ãƒ‰)    â”‚
           â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚         â†“
           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  â”‚ çµæœã‚’ä¿å­˜          â”‚
           â”‚  â”‚ (.mao/queue/results)â”‚
           â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚         â”‚
           â””â”€ No     â”‚
              â”‚      â”‚
              â†“      â†“
           (å¾…æ©Ÿ: 2ç§’)
              â”‚
              â””â”€â”€â”€â”€â”€â”€â†’ ãƒ«ãƒ¼ãƒ—
```

#### å®Ÿè¡Œä¾‹

```bash
# tmux ãƒšã‚¤ãƒ³å†…ã§å®Ÿè¡Œ
python3 mao/orchestrator/worker_loop.py \
    --role worker-1 \
    --project-path /Users/user/project \
    --model sonnet \
    --poll-interval 2.0

# å‡ºåŠ›:
ğŸ¤– Worker worker-1 started
ğŸ“ Project: /Users/user/project
ğŸ”§ Model: sonnet
â±ï¸  Poll interval: 2.0s

============================================================
Waiting for tasks...
============================================================

# ã‚¿ã‚¹ã‚¯ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ã¨...
============================================================
ğŸ“¥ Task #1 received: task-001
============================================================

ğŸš€ Executing claude-code with model: sonnet
ğŸ“ Prompt: ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„...

âœ… Task completed in 45.2s
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Result:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚
ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸ:
- login.py
- login_test.py
...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“¤ Result submitted

============================================================
Waiting for next task...
============================================================
```

## ğŸ¨ ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

### 3Ã—3 ã‚°ãƒªãƒƒãƒ‰ï¼ˆ9ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ MANAGER  â”‚ ğŸ”§ WORKER-1 â”‚ ğŸ”§ WORKER-2 â”‚
â”‚             â”‚             â”‚             â”‚
â”‚ Interactive â”‚ Worker Loop â”‚ Worker Loop â”‚
â”‚ Claude Code â”‚             â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”§ WORKER-3 â”‚ ğŸ”§ WORKER-4 â”‚ ğŸ”§ WORKER-5 â”‚
â”‚             â”‚             â”‚             â”‚
â”‚ Worker Loop â”‚ Worker Loop â”‚ Worker Loop â”‚
â”‚             â”‚             â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”§ WORKER-6 â”‚ ğŸ”§ WORKER-7 â”‚ ğŸ”§ WORKER-8 â”‚
â”‚             â”‚             â”‚             â”‚
â”‚ Worker Loop â”‚ Worker Loop â”‚ Worker Loop â”‚
â”‚             â”‚             â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒšã‚¤ãƒ³ã‚¿ã‚¤ãƒˆãƒ«è¨­å®š

```python
# ãƒšã‚¤ãƒ³å¢ƒç•Œã«ã‚¿ã‚¤ãƒˆãƒ«ã‚’è¡¨ç¤º
subprocess.run([
    "tmux", "set-option", "-t", session_name,
    "pane-border-status", "top"
])
subprocess.run([
    "tmux", "set-option", "-t", session_name,
    "pane-border-format", "#[fg=cyan,bold] #{pane_title} "
])

# å„ãƒšã‚¤ãƒ³ã«ã‚¿ã‚¤ãƒˆãƒ«ã‚’è¨­å®š
subprocess.run([
    "tmux", "select-pane", "-t", pane_id,
    "-T", "ğŸ“‹ MANAGER"
])
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦–ç‚¹

```bash
# 1. MAO ã‚’èµ·å‹•ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ tmux ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆï¼‰
mao start "èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…"

# 2. CTOã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒèµ·å‹•
# CTOã¨ãƒãƒ£ãƒƒãƒˆå¯èƒ½ã€ã‚¿ã‚¹ã‚¯åˆ†è§£ãƒ»ãƒ¯ãƒ¼ã‚«ãƒ¼ç®¡ç†ã‚’è‡ªå‹•å®Ÿè¡Œ

# 3. åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ tmux ã«ã‚¢ã‚¿ãƒƒãƒã—ã¦ä½œæ¥­ã‚’ç¢ºèª
tmux attach -t mao

# â†’ 3Ã—3 ã‚°ãƒªãƒƒãƒ‰ã§å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä½œæ¥­ãŒè¦‹ãˆã‚‹
# â†’ Ctrl+B â†’ çŸ¢å°ã‚­ãƒ¼ ã§ãƒšã‚¤ãƒ³åˆ‡ã‚Šæ›¿ãˆ
# â†’ Ctrl+B â†’ z ã§ãƒšã‚¤ãƒ³ã‚’ã‚ºãƒ¼ãƒ 
# â†’ Ctrl+B â†’ d ã§ãƒ‡ã‚¿ãƒƒãƒ
```

### ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ†ã‚£ãƒƒã‚¯ãªä½¿ç”¨

```python
from pathlib import Path
from mao.orchestrator.tmux_manager import TmuxManager
from mao.orchestrator.task_queue import TaskQueue, Task

# 1. Tmux ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ
tmux = TmuxManager(use_grid_layout=True, num_workers=8)
tmux.create_session()

# 2. å„ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒšã‚¤ãƒ³ã§ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ«ãƒ¼ãƒ—ã‚’èµ·å‹•
for i in range(1, 9):
    role = f"worker-{i}"
    pane_id = tmux.grid_panes.get(role)

    tmux.start_worker_loop_in_pane(
        pane_id=pane_id,
        role=role,
        project_path=Path.cwd(),
        model="sonnet",
    )

# 3. ã‚¿ã‚¹ã‚¯ã‚’å‰²ã‚Šå½“ã¦
queue = TaskQueue(Path.cwd())

for i in range(1, 5):
    task = Task(
        task_id=f"task-{i:03d}",
        role=f"worker-{i}",
        prompt=f"ã‚¿ã‚¹ã‚¯ {i} ã‚’å®Ÿè£…ã—ã¦ãã ã•ã„",
        model="sonnet",
    )
    queue.assign_task(task)

# 4. çµæœã‚’åé›†
import time
completed = []

while len(completed) < 4:
    for i in range(1, 5):
        role = f"worker-{i}"
        if role not in completed and queue.has_result(role):
            result = queue.get_result(role)
            print(f"âœ… {role}: {result.result[:50]}...")
            completed.append(role)

    time.sleep(1.0)
```

## ğŸ’° ã‚³ã‚¹ãƒˆæœ€é©åŒ–

### Event-Driven ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®åˆ©ç‚¹

YAML ãƒ•ã‚¡ã‚¤ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã«ã‚ˆã‚Šã€**å¾…æ©Ÿä¸­ã® API æ¶ˆè²»ã¯ã‚¼ãƒ­**ã€‚

```
å¾“æ¥ã®æ–¹æ³•ï¼ˆãƒãƒ¼ãƒªãƒ³ã‚°ï¼‰:
  ãƒ¯ãƒ¼ã‚«ãƒ¼: ã€Œã‚¿ã‚¹ã‚¯ã‚ã‚‹ï¼Ÿã€ â†’ API å‘¼ã³å‡ºã—
  å¿œç­”: ã€Œãªã„ã€
  ãƒ¯ãƒ¼ã‚«ãƒ¼: (1ç§’å¾…æ©Ÿ)
  ãƒ¯ãƒ¼ã‚«ãƒ¼: ã€Œã‚¿ã‚¹ã‚¯ã‚ã‚‹ï¼Ÿã€ â†’ API å‘¼ã³å‡ºã—
  å¿œç­”: ã€Œãªã„ã€
  ...
  â†’ å¾…æ©Ÿä¸­ã‚‚ API ã‚’æ¶ˆè²»

æ–°ã—ã„æ–¹æ³•ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ï¼‰:
  ãƒ¯ãƒ¼ã‚«ãƒ¼: (ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒã‚§ãƒƒã‚¯ - API å‘¼ã³å‡ºã—ãªã—)
  ãƒ¯ãƒ¼ã‚«ãƒ¼: (ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒã‚§ãƒƒã‚¯ - API å‘¼ã³å‡ºã—ãªã—)
  ãƒ¯ãƒ¼ã‚«ãƒ¼: (ã‚¿ã‚¹ã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ç™ºè¦‹ï¼)
  ãƒ¯ãƒ¼ã‚«ãƒ¼: â†’ claude-code å®Ÿè¡Œï¼ˆã“ã®æ™‚ã ã‘ API å‘¼ã³å‡ºã—ï¼‰

  â†’ å¾…æ©Ÿä¸­ã¯ API æ¶ˆè²»ã‚¼ãƒ­
```

ã“ã‚Œã«ã‚ˆã‚Šã€Claude Max Ã—5 ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã§ 9 ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ä¸¦åˆ—å®Ÿè¡ŒãŒå¯èƒ½ã€‚

## ğŸ”§ æŠ€è¡“çš„ãªæ³¨æ„ç‚¹

### 1. send-keys ã® 2 å›åˆ†å‰²

```python
# âŒ NG: Enter ãŒåŠ¹ã‹ãªã„
subprocess.run(["tmux", "send-keys", "-t", pane_id, "command", "Enter"])

# âœ… OK: ã‚³ãƒãƒ³ãƒ‰ã¨ Enter ã‚’åˆ¥ã€…ã«
def _send_to_pane(self, pane_id: str, command: str):
    subprocess.run(["tmux", "send-keys", "-t", pane_id, command, "C-m"])
```

### 2. ã‚·ã‚§ãƒ«ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–

```python
import shlex

# ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’å«ã‚€ã‚³ãƒãƒ³ãƒ‰
safe_path = shlex.quote(str(work_dir))
command = f"cd {safe_path}"
```

### 3. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

```python
# ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ›¸ãè¾¼ã¿
prompt_file = work_dir / f".mao_prompt_{pane_id.replace(':', '_')}.txt"
prompt_file.write_text(prompt)

# ä½¿ç”¨å¾Œã«å‰Šé™¤
try:
    prompt_file.unlink()
except FileNotFoundError:
    pass
```

### 4. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š

```python
# claude-code ã®å®Ÿè¡Œæ™‚é–“åˆ¶é™ï¼ˆ10åˆ†ï¼‰
result = subprocess.run(
    cmd,
    timeout=600,  # 10 minutes
)
```

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ  vs Redis

| æ–¹å¼ | ãƒ¬ã‚¤ãƒ†ãƒ³ã‚· | å®Ÿè£…ã®è¤‡é›‘ã• | ä¾å­˜é–¢ä¿‚ |
|------|----------|------------|---------|
| YAML ãƒ•ã‚¡ã‚¤ãƒ« | ~1-5ms | ä½ | ãªã— |
| Redis | ~0.1-1ms | ä¸­ | Redis ã‚µãƒ¼ãƒãƒ¼ |
| SQLite | ~0.5-2ms | ä¸­ | ãªã— |

**ç¾åœ¨ã®å®Ÿè£…:** YAML ãƒ•ã‚¡ã‚¤ãƒ«
- ã‚·ãƒ³ãƒ—ãƒ«
- å¤–éƒ¨ä¾å­˜ãªã—
- ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã«æœ€é©
- ååˆ†é«˜é€Ÿï¼ˆ2ç§’ãƒãƒ¼ãƒªãƒ³ã‚°ãªã®ã§å·®ã¯ç„¡è¦–å¯èƒ½ï¼‰

**å°†æ¥ã®æ‹¡å¼µ:**
- é«˜é€ŸåŒ–ãŒå¿…è¦ãªå ´åˆã¯ Redis ã«åˆ‡ã‚Šæ›¿ãˆå¯èƒ½
- TaskQueue ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¯åŒã˜ãªã®ã§ç§»è¡Œå®¹æ˜“

## ğŸ”— å‚è€ƒ

- [multi-agent-shogun - Zenn](https://zenn.dev/shio_shoppaize/articles/5fee11d03a11a1)
- [Git Worktree ã«ã‚ˆã‚‹ç’°å¢ƒåˆ†é›¢](./WORKTREE_ISOLATION.md)
- [ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ä»•æ§˜](./INTERACTIVE_MODE.md)
